<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Locate the user</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.js'></script>
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.5.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body 
        { 
        	margin:0; 
        	padding:0; 
        }

        #header
        {
        	height:60px;
        	width:100%;
        	background: #222;
        	color:#fff;
        	position: absolute;;
        }

        a 
        {
        	color: #BBE5DA;
        	margin:10px;
        	position: center
        }

        #map 
        { 
        		position:absolute; 
        		top:0; 
        		bottom:0; 
        		width:100%; 
        		height: calc(100% - 60px);
        		margin-top: 60px;
        	}
    </style>
</head>
<body>

<!-- <div id='header' class='topnav'> -->
<nav class="navbar navbar-inverse" role="navigation" id='header'>
	<a class='active' href='#home'>Home</a>
	<a href='https://hdffa.org/'>
	 <img src='https://hdffa.org/wp-content/uploads/2017/11/hdffa_color_logo2_horiz-1.png</a>
</nav>
<!-- </div> -->
<div id='map'></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoibDByZWxsZWkiLCJhIjoiY2syZ2h0YXhoMHZhdzNpdGd1c3E0azlobCJ9.KlpdomPse99D7VyPdExaLg';
var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [
      -121.260588,
      44.209118
    ], // starting position
    zoom: 9 // starting zoom
});

// Add geolocate control to the map.
map.addControl(new mapboxgl.GeolocateControl({
    positionOptions: {
        enableHighAccuracy: true
    },
    trackUserLocation: true
}));



var geojson = [{
  "type": "Feature",
  "properties": {
    "accuracy": "point",
    "address": "7600 Southwest Quarry Avenue, Redmond, Oregon 97756, United States",
    "phone": "541 923-5076",
    "products": "Meat, Poultry",
    "name": "Central Oregon Farm"
  },
  "geometry": {
    "coordinates": [
      -121.260588,
      44.209118
    ],
    "type": "Point"
  }
},
{
  "type": "Feature",
  "properties": {
    "accuracy": "point",
    "address": "18130 Mckenzie Highway, Sisters, Oregon 97759, United States",
    "phone": "541 213-6406",
    "products": "Meat, Poultry, Eggs",
    "name": "Cascade Mountains Pasture"
  },
  "geometry": {
    "coordinates": [
      -121.425355,
      44.29337
    ],
    "type": "Point"
  }
},
{
  "type": "Feature",
  "properties": {
    "accuracy": "point",
    "address": "22225 Bear Creek Road, Bend, Oregon 97701, United States",
    "phone": "415 609-3677",
    "products": "Meat, Poultry",
    "name": "Freedom Rock Farms"
  },
  "geometry": {
    "coordinates": [
      -121.211005,
      44.045741
    ],
    "type": "Point"
  }
}]


for (var i=0;i<geojson.length;i++)
{
	var point = geojson[i];

	var popup = new mapboxgl.Popup({offset:[0, -15]})
		.setHTML('<h3 style="padding:0;margin-bottom:0;">' + point.properties.name + '</h3>' +
			point.properties.phone);

	var marker = new mapboxgl.Marker()
                            .setLngLat(point.geometry.coordinates)
                            .addTo(map)
                            .setPopup(popup);

    point.marker = marker;   


}


//Add popup
</script>

</body>
</html>